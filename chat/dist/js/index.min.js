"use strict";var ChatModule={init:function(){var e=this;e.domInit(),e.event()},domInit:function(){var e=this;e.domLoginView=document.querySelector("#LoginView"),e.domLogin=document.querySelector("#Login"),e.domNickName=document.querySelector("#NickName"),e.domMsgView=document.querySelector("#MsgView"),e.domMsgText=document.querySelector("#MsgText"),e.domMsgSend=document.querySelector("#MsgSend"),e.domChatView=document.querySelector("#ChatView"),e.domMsgView=document.querySelector("#MsgView"),e.viewInit()},viewInit:function(){var e=this;e.nClientWidth=document.body.clientWidth||document.documentElement.clientWidth,e.nClientHeight=document.body.clientHeight||document.documentElement.clientHeight,e.domChatView.style.height=window.document.documentElement.clientHeight+"px",e.domMsgView.style.height=window.document.documentElement.clientHeight+"px"},event:function(){var e=this;window.addEventListener("resize",function(){e.viewInit()}),e.domLogin.addEventListener("click",function(){var i=e.domNickName.value;return i?(e.domLoginView.style.display="none",e.sNick=i,void e.socketConn({nick:e.sNick,type:"Prompt",msg:e.sNick+"加入了聊天"})):(alert("名字还是要填的!"),!1)}),e.domMsgSend.addEventListener("click",function(){var i=e.domMsgText.value;return i?(e.domMsgText.value="",void e.wsSend({nick:e.sNick,type:"Send",msg:i})):(alert("消息还是要填的!"),!1)})},socketConn:function(e){var i=this;i.ws=new WebSocket("ws://chat.fenghou.site:8181"),i.ws.onopen=function(t){console.log("Connection to server opened");var n=e;i.ws.readyState===WebSocket.OPEN&&i.wsSend(n)},i.ws.onmessage=function(e){i.appendMsg(JSON.parse(e.data))}},wsSend:function(e){var i=this;i.ws.send(JSON.stringify(e))},appendMsg:function(e){var i=this,t=i.domMsgView.innerHTML;"Prompt"==e.type&&(t+=' <div class="system"> <span>'+e.msg+"</span> </div>"),"Send"==e.type&&(t+=e.nick==i.sNick?' <div class="msg"> <div class="ico right"> <div class="img"> </div> <div class="nick">'+e.nick+'</div> </div> <div class="text right">'+e.msg+"</div> </div>":' <div class="msg"> <div class="ico"> <div class="img"> </div> <div class="nick">'+e.nick+'</div> </div> <div class="text">'+e.msg+"</div> </div>"),i.domMsgView.innerHTML=t}};ChatModule.init();